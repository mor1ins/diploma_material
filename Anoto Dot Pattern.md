# Anoto Dot Pattern Technology

## Введение

Anoto Dot Pattern Technology была изобретена и разработана Anoto AB Group для использования с их цифровым пером для электронных бумажных приложений. Эта технология позволяет создать абсолютную систему координат для оцифровки рукописного текста и изображений путем печати на бумаге специального точечного шаблона. [13] Таким образом, когда кто-то пишет на цифровой бумаге, ручка записывает координаты, которые затем передаются на компьютер или смартфон [14] [15].

Описанная информация об их технологии извлечена из общедоступной информации на их веб-сайте и о патентах. У них также есть комплект для разработки программного обеспечения, позволяющий сторонним разработчикам использовать их перо. Однако это SDK дает доступ к информации на высоком уровне. В этой части диссертации будет продемонстрирован собственный метод декодирования точечного шаблона для получения координат, а затем изложено исследование возможности использования этой информации для позиционирования.

<img src="file:////Users/mor1ins/projects/diploma/img/image001.jpg" style="zoom:67%;" />

​						**Фрагмент шаблона (для демонстрации на шаблон нанесены линии)**



## Принципы работы 

Этот раздел суммирует методы, описанные Anoto в их патентах, и предназначен для того, чтобы предоставить читателю достаточно ссылок для понимания кода MATLAB в Приложении B.

Точечный шаблон, имеющий форму сетки с шагом 0,3 мм, состоит из множества маленьких черных точек. Вместо того, чтобы располагаться точно на пересечении растровых линий (называемых «номинальной позицией»), каждая точка слегка смещается вблизи пересечения в одном из четырех направлений: вверх, вниз, влево и вправо. Все четыре вида расположения точек показаны на рисунке ниже.



<img src="file:////Users/mor1ins/projects/diploma/img/image002.jpg" alt="img" style="zoom:67%;" />

​											**Четыре вида расположения точек [13]**



Таким образом 4 возможные позиции позволяют закодировать два бита информации в каждом элементе. Последовательность из таких точек в блоке образуют координаты x и y, причем в каждой точке один бит используется для кодирования координаты x, а второй для координаты y. Пара из X‑бита и Y‑бита назначается для каждого типа (направления) смещения, как показано в таблице 4-1.



| Направление смещения | x бит | y бит |
| :------------------: | :---: | :---: |
|        Влево         |   1   |   0   |
|        Вправо        |   0   |   1   |
|        Вверх         |   0   |   0   |
|         Вниз         |   1   |   1   |

**Таблица 4-1. Преобразование между направлением смещения и кодовой парой [13]**



Таким образом, координаты x и y могут считываться одновременно и независимо, если имеется фрагмент шаблона, содержащий массив точек больше определенного размера. Блок 8x8 с закодированными координатами, показан на рисунке 4-3.

 

<img src="file:////Users/mor1ins/projects/diploma/img/image003.jpg" alt="img" style="zoom:50%;" />

​						**Пример блока 8×8 для шаблона Anoto Dot Pattern [13,23]**



Чтобы идентифицировать положение, необходим, по крайней мере, фрагмент точечного рисунка, содержащий 6 × 6 точек [24]. Но в Anoto Dot Pattern блоки по 8×8 [13], где добавлены по одной точке для поворота и для исправления ошибок. Одним из наиболее важных свойств шаблона является то, что массив, образованный любыми точками 8×8, появляется только один раз по всей поверхности, что позволяет идентифицировать уникальные позиции.

Причина, по которой шаблон обладает вышеуказанным свойством, состоит в том, что код, в который он закодирован, разработан с использованием специальной последовательности De Bruijin [25, 42, 47]. Эта последовательность чисел является циклической, и длина последовательности специально предназначена для того, чтобы любая частичная последовательность определенной длины, взятая из основной последовательности, встречалась только один раз. В патентах Anoto [13] специально разработанная квази-последовательность De Bruijin [25] называется main number sequence (MNS) и имеет в общей сложности 63 числа. Она представлена ниже:

```python
MNS = [ 
  0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 
  1, 1, 1, 1, 0, 1, 0, 0, 1, 0, 
  0, 0, 0, 1, 1, 1, 0, 1, 1, 1, 
  0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 
  1, 0, 1, 1, 0, 1, 1, 0, 0, 1, 
  1, 0, 1, 0, 1, 1, 1, 1, 0, 0, 
  0, 1, 1 
]
```

Любая частичная последовательность длины 8 имеет значение позиции от 0 до 62. Например, последовательность **0000 0010** имеет значение позиции **0**, а **0000 0100**, сдвинутая вправо, имеет значение позиции **1**.

MNS сдвигается вверх/вниз в столбцах и влево/вправо в строках на разные значения и повторяется, когда она подходит к концу. Следовательно, соседние два столбца или две строки имеют постоянную разность чисел. Например, что касается направления x, если столбец k содержит последовательность основных чисел, сдвинутую на число строк l, а столбец k + 1 содержит последовательность основных чисел, сдвинутую на количество строк m, разность этих двух столбцов будет равна (lm) по модулю 63. Разностные числа между столбцами и строками образуют другую важную последовательность, называемую первичной разностной последовательностью (PDS). Как можно легко заметить, хотя каждый столбец и каждая строка начинаются с идентичного MNS, смещенного на разные номера, PDS не изменяется от строки к строке для направления x и от столбца к столбцу для направления y.

Массив 8×8 этого типа точечного шаблона имеет восемь столбцов и восемь строк, которые могут быть закодированы в восемь вертикальных частичных последовательностей, и восемь горизонтальных частичных последовательностей, каждая из них имеет длину восемь. Каждая частичная последовательность затем имеет соответствующий номер позиции для направления x и направления y отдельно. Кроме того, два частичных PDS длиной 7 для направлений x и y также могут быть получены отдельно.



<img src="file:////Users/mor1ins/projects/diploma/img/image004.jpg" alt="img" style="zoom:67%;" />

​	**Кодирование вертикальный частичных последовательностей в направлении x [13]**



Положение частичного PDS в целом PDS является одним из ключевых элементов информации, который сообщает нам о координатах. Хотя разностные числа получают с помощью разностей по модулю 63 и, следовательно, все они находятся в диапазоне от 0 до 62, могут использоваться только значения со значениями от 5 до 58, то есть 54 числа. Если число не попадает в этот диапазон, то значит произошла ошибка.

На практике первичная разностная последовательность дополнительно преобразуется в так называемые вторичные разностные числовые последовательности (SDS) для целей расчета, обнаружения и исправления ошибок [17]. Для любой разности число d принадлежит [5, 58], биекция может быть установлена с использованием правил, описанных ниже, где a1, a2 и a4 имеют значения от 0 до 2, а a3 - от 0 до 1.
$$
d = 5 + a1 + 3 * a2 + 3^2 * a3 + 2 * 3^2 * a4;
$$
Например, если d = 35, то 
$$
d = 5 + 3 + 9 + 18 =
$$

$$
= 5 + a1 + 3 * a2 + 3^2 * a3 + 2 * 3^2 * a4,
$$

$$
a1 = 0, a2 = 1, a3 = 1, a4 = 1
$$

Таким образом, d = 35 в представлении (a1, a2, a3, a4) равно (0, 1, 1, 1). Таким образом, первичная разностная последовательность преобразуется в четыре вторичные разностные последовательности, как показано в таблице 4-5.



<img src="file:////Users/mor1ins/projects/diploma/img/image005.jpg" alt="img" style="zoom:67%;" />

​		**Преобразование последовательности из PDS в четыре последовательности SDS [13]**

 

Если найдены номера позиций частичных вторичных разностных последовательностей во всех вторичных разностных последовательностях, то номер позиции частичного PDS может быть рассчитан с использованием китайской теоремы об остатках [44]. Поэтому четыре последовательности вторичных разностных чисел A1 ‑ A4 вводятся, как показано ниже [13].

``` python
A_1 = [
  0,0,0,0,0,1,0,0,0,0, 2,0,1,0,0,1,0,1,0,0, 
  2,0,0,0,1,1,0,0,0,1, 2,0,0,1,0,2,0,0,2,0, 
  2,0,1,1,0,1,0,1,1,0, 2,0,1,2,0,1,0,1,2,0, 
  2,1,0,0,1,1,1,0,1,1, 1,1,0,2,1,0,1,0,2,1, 
  1,0,0,1,2,1,0,1,1,2, 0,0,0,2,1,0,2,0,2,1, 
  1,1,0,0,2,1,2,0,1,1, 1,2,0,2,0,0,1,1,2,1, 
  0,0,0,2,2,0,1,0,2,2, 0,0,1,2,2,0,2,0,2,2, 
  1,0,1,2,1,2,1,0,2,1, 2,1,1,0,2,2,1,2,1,2, 
  0,2,2,0,2,2,2,0,1,1, 2,2,1,1,0,1,2,2,2,2, 
  1,2,0,0,2,2,1,1,2,1, 2,2,1,0,2,2,2,2,2,0, 
  2,1,2,2,2,1,1,1,2,1, 1,2,0,1,2,2,1,2,2,0, 
  1,2,1,1,1,1,2,2,2,0, 0,2,1,1,2,2
]

```

```python
A_2 = [
  0,0,0,0,0,1,0,0,0,0, 2,0,1,0,0,1,0,1,0,1, 
  1,0,0,0,1,1,1,1,0,0, 1,1,0,1,0,0,2,0,0,0, 
  1,2,0,1,0,1,2,1,0,0, 0,2,1,1,1,0,1,1,1,0, 
  2,1,0,0,1,2,1,2,1,0, 1,0,2,0,1,1,0,2,0,0, 
  1,0,2,1,2,0,0,0,2,2, 0,0,1,1,2,0,2,0,0,2, 
  2,2,1,0,1,2,2,0,0,2, 1,2,2,1,1,1,1,1,2,0, 
  0,1,2,2,1,2,0,1,1,1, 2,1,1,2,0,1,2,1,1,1, 
  2,2,0,2,2,0,1,1,2,2, 2,2,1,2,1,2,2,0,1,2, 
  2,2,0,2,0,2,1,1,2,2, 1,0,2,2,0,2,1,0,2,1, 
  1,0,2,2,2,2,0,1,0,2, 2,1,2,2,2,1,1,2,1,2,
  0,2,2,2
]
```

```python
A_3 = [
  0,0,0,0,0,1,0,0,1,1, 0,0,0,1,1,1,1,0,0,1,
  0,1,0,1,1,0,1,1,1,0, 1
]
```

```python
A_4 = [
  0,0,0,0,0,1,0,2,0,0, 0,0,2,0,0,2,0,1,0,0, 
  0,1,1,2,0,0,0,1,2,0, 0,2,1,0,0,0,2,1,1,2, 
  0,1,0,1,0,0,1,2,1,0, 0,1,0,0,2,2,0,0,0,2, 
  2,1,0,2,0,1,1,0,0,1, 1,1,0,1,0,1,1,0,1,2, 
  0,1,1,1,1,0,0,2,0,2, 0,1,2,0,2,2,0,1,0,2, 
  1,0,1,2,1,1,0,1,1,1, 2,2,0,0,1,0,1,2,2,2, 
  0,0,2,2,2,0,1,2,1,2, 0,2,0,0,1,2,2,0,1,1, 
  2,1,0,2,1,1,0,2,0,2, 1,2,0,0,1,1,0,2,1,2, 
  1,0,1,0,2,2,0,2,1,0, 2,2,1,1,1,2,0,2,1,1, 
  1,0,2,2,2,2,0,2,0,2, 2,1,2,1,1,1,1,2,1,2, 
  1,2,2,2,1,0,0,2,1,2, 2,1,0,1,1,2,2,1,1,2, 
  1,2,2,2,2,1,2,0,1,2, 2,1,2,2,0,2,2,2,1,1
] 
```

Они имеют длину 236, 233, 31 и 241 соответственно. Длины выбираются взаимно простыми, поэтому наименьшее общее кратное из четырех последовательностей будет произведением их длин. Тогда соответствующие места p1, p2, p3 и p4 частичной последовательности длины 5 в этих четырех вторичных разностных последовательностях могут быть определены с использованием того же метода определения места P частичной последовательности в первичной разностной последовательности, который был указан выше. И они имеют отношение, перечисленное ниже:
$$
P ≡ p1 (mod 236)
$$

$$
P ≡ p2 (mod 233)
$$

$$
P ≡ p3 (mod 31)
$$

$$
P ≡ p4 (mod 241)
$$

где 236, 233, 31, 241 - длины вторичных разностных последовательностей. 

В результате P можно рассчитать с помощью китайской теоремы об остатках [26]. Фактически, нет необходимости вычислять номер позиции P частичного PDS, поскольку мы знаем, что четыре номера позиций p1, p2, p3, p4 частичного SDS определяют P, а затем определяют координаты x или y. Существует также биекция между (p1x, p2x, p3x, p4x) и x, а также (p1y, p2y, p3y, p4y) и y, где x, y - координаты в направлениях x и y. Здесь x обозначает x-й столбец, y обозначает y-й ряд, который дает нам информацию напрямую. Это именно то, что мы используем в этом тезисе.

Другой важный фактор называется «Section» [13]. Поскольку существует 63 различных смещения для первичной разностной последовательности, следовательно, существует 63 возможных значения, которые могут начинать самую первую координату x и первую координату y соответственно. Это в сумме дает 3969 (63 * 63) различных комбинаций точечного рисунка [13]. И какие два числа начинаются с первого столбца и первой строки, называются номерами секций для направления x и номерами секций для направления y соответственно. Это используется, когда нужно позиционироваться по большому количеству поверхностей. Поскольку поверхность, используемая в этом тезисе, намного меньше, нет проблем с управлением различными «сечениями» поверхности. Поэтому нет необходимости рассчитывать номер раздела. На самом деле, они представлены в качестве известного параметра в экспериментах, изложенных в главе 5.